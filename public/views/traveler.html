<div class='container'>

<div ng-show='!travelerData.readyReview''>
	<button
	    class='btn btn-default btn-xs pull-right hidden-print'
	    type='button'
	    ng-click='topCollapse = !topCollapse'
	    ng-show='!topCollapse'
	>
	    <i class="fa fa-minus-square-o" aria-hidden="true"></i>
	</button>
	<button
	    class='btn btn-default btn-xs pull-right hidden-print'
	    type='button'
	    ng-click='topCollapse = !topCollapse'
	    ng-show='topCollapse'

	>  
		<i class="fa fa-plus-square-o" aria-hidden="true"></i>
	</button>
</div>
<br>
	<div ng-show='topCollapse && !travelerData.readyReview'>
		<h4>Serial Number: {{travelerData.sn}}</h4>
		<h4>Doc Num: {{travelerData.itemRecord.docNum}}</h4>
		<button class='btn btn-primary btn-md pull-right' ng-click='checkReadyReview()'>
			<!-- <i class="fa fa-check" aria-hidden="true"></i>  -->
			Ready for Review						
		</button>
		<button class='btn btn-primary btn-md pull-right' ng-click='save()' style='margin-right: 3px'>
			<!-- <i class="fa fa-check" aria-hidden="true"></i>  -->
			save				
		</button>
		<br>
		<hr>
	</div>
	<div ng-show='!topCollapse && !travelerData.readyReview'>
		<input type='button' class='btn btn-warning btn-md pull-right myButton hidden-print' value='New' ng-click='new()'/>
		<input type='button' class='btn btn-danger btn-md pull-right myButton hidden-print' value='Delete' ng-click='delete()'/>
		<form role='form'>
			<div class='form-group hidden-print' style='margin-bottom: 0px'>
				<label for='select-formId'>Select a Template:</label>
				<select class='form-control' id='select-formId' ng-model='formId' ng-change='updateForm()' ng-disabled='travelerData.created'>
					<option value="">---Please select---</option>
					<option ng-repeat='option in formList |filter:{isPublish:true}' value='{{option._id}}'>Doc. {{option.formNo}} Rev. {{option.formRev}}</option>
				</select>
			</div>
		</form>
	</div>

	<div ng-show='!travelerData.readyReview && formId' class='container'>
		<div name='header' ng-show='!topCollapse'>
			<div class='row'>
				<div class='col-xs-8'>
					<div class='col-xs-6'>
						<h4>Serial Number: <input type="text" class='form-control' ng-model='travelerData.sn' ng-blur='checkForSN()' autofocus style='width: 200px'/></h4>
						<span ng-if='isSNExist' style='color:red;'>* Same Serial Number detect in database.</span><br>
						<select ng-show='isSNExist' class='form-control' style='width:auto;' ng-model='selectSN'>
							<option ng-repeat='item in searchSN' value='{{$index}}'>
								Create At: {{item.createAt|date: 'shortDate'}}  Status: {{item.status}}
							</option>
						</select>
						<br>
						<button ng-if='isSNExist' class='btn btn-primary btn-sm' ng-click='setTravelerData()'>
							Open/Use
						</button>
					</div>
					<div class='col-xs-6'>
						<h4>Customer</h4><span> - {{forms.customer}}</span>
						<h4>Status</h4><span> - {{travelerData.status}}</span>
					</div>
				</div>
				<div class='col-xs-4'>
					<br>
					<button class='btn btn-primary btn-md pull-right' ng-click='checkReadyReview()'>
						<!-- <i class="fa fa-check" aria-hidden="true"></i>  -->
						Ready for Review						
					</button>
					<button class='btn btn-primary btn-md pull-right' ng-click='save()' style='margin-right: 3px'>
						<!-- <i class="fa fa-check" aria-hidden="true"></i>  -->
						save				
					</button>
				</div>
			</div>
			<hr>
		</div>

		<div name='itemRecord' ng-show='!topCollapse'>
			<div class='form-group'>
				<label class='control-label' for='docNumSelect'>Select Document#:</label>
				<select ng-init='docNum.docNumSelect="new"' class='form-control' id='docNumSelect' ng-model='docNum.docNumSelect' ng-change='updateDocNum()'>
					<option value='new'>Create New Doc#</option>
					<optgroup ng-repeat='op in docNum.docNumSelectList | unique:"docNum" | orderBy:"docNum"' label='{{op.docNum}}'>
						<option ng-repeat='chilop in docNum.docNumSelectList' ng-if='chilop.docNum === op.docNum' value='{{$index}}'>Doc# {{op.docNum}} Model - {{chilop.label}}</option>
					</optgroup>
				</select>
			</div>

			<div class='form-inline' role='form'>
				<div class='form-group'>
					<label for='docNum'>Document#</label>
					<input type="text" id='docNum' class='form-control' ng-model='docNum.docNumData.docNum' ng-disabled='docNum.docNumSelect !== "new"'>
				</div>
				<div class='form-group' ng-repeat='item in forms.itemRecord'>
					<label for='{{item.Description}}'>{{item.Description}}: </label>
					<input ng-if="!item.select && !item.radio && !item.checkbox" type='text' class='form-control' id='{{item.Description}}' ng-model='docNum.docNumData.attribute[item.Description]'>
					
					<!-- select -->
					<select class='form-control' ng-if='item.select' ng-model='docNum.docNumData.attribute[item.Description]["select"]'>
						<option value="">---Please select---</option>
						<option ng-repeat='option in item.select.options' value='{{option}}'>
							{{option}}
						</option>
					</select>
				</div>

				<div class='form-group' ng-if='docNum.docNumSelect !== "new"'>
					<button class='btn btn-primary btn-md pull-right' ng-click='editDocNum()'>
						Edit/Save						
					</button>
				</div>
				<div class='form-group' ng-if='docNum.docNumSelect === "new"'>
					<button class='btn btn-primary btn-md pull-right' ng-click='saveDocNum()'>
						Create						
					</button>
				</div>
			</div>

			<br>
			<hr style='margin-top: 1px; margin-bottom: 4px'>
		</div>

	<div name='steps'>

			<div id='form-container'>
				<h4>Step {{currentStep}}.{{currentSubStep}}</h4>

				<div id='status-buttons' class='text-right'>
					<a ng-class='{active: currentStep == step.step}' ng-repeat='step in forms.steps' ng-click='statusPage(step.step)'><span>{{step.step}}</span></a>
				</div>

				<input class='btn btn-primary myButton btn-md pull-right' ng-if='!travelerData.readyReview' type="button" value='next' ng-click='nextStep()'/>
				<div id='steps' ng-repeat='step in forms.steps'>
					<div class='page-header' ng-if='currentStep == step.step'>
					 <h4>{{step.type}} :: {{step.Description}}</h4>
					</div>
					<!-- Step -->
					<div ng-repeat='subStep in step.list'>

						<!-- form -->
						<form class='form-horizontal' role='form' ng-show='subStep.sub_step== currentSubStep && currentStep == step.step'>
							<h4><strong>{{subStep.Description}}</strong></h4>
		<!-- 					<div class='form-group'>
								<label class='control-label col-sm-2'>Qulity: </label>
								<div class='col-sm-10'>
									<input 
										type='number' 
										class='form-control' 
										placeholder='0' 
										ng-model='travelerData.step[step.step][subStep.sub_step]["qty"]'
										ng-change='appendSubStepEditInfo()'>
								</div>
							</div> -->

							<div ng-if='subStep.options'>
								<div class='form-group' ng-repeat='op in subStep.options'>
									<label class='control-label col-sm-2'>{{op.name}}:</label>
									<div class='col-sm-10'>
										<div ng-if='op.type ==="checkbox"'>
										<!-- checkbox -->
											<label
												class='checkbox-inline' 
												ng-repeat='checkOp in op.options'
											>
												<input 
													type="checkbox" 
													value='{{checkOp}}'
													ng-model='travelerData.step[step.step][subStep.sub_step]["options"][$parent.$index][$index]'
													ng-change='appendSubStepEditInfo()'
													>{{checkOp}}
											</label>
										</div>
										<div ng-if='op.type ==="select"'>
										<!-- select -->
											<select 
												class='form-control'
												ng-model='travelerData.step[step.step][subStep.sub_step]["options"][$parent.$index]'
												ng-change='appendSubStepEditInfo()'>
												<option value=''>---Please select---</option>
												<option ng-repeat='selectOp in op.options'
														value='{{$index}}'>{{selectOp}}</option>
											</select>
										</div>
										<!-- radio -->
										<div ng-if='op.type ==="radio"'>
											<label ng-repeat='radioOp in op.options'
												   class='radio-inline'>
												<input 
													type="radio"
													name="radio"
													value='{{$index}}'
													ng-model='travelerData.step[step.step][subStep.sub_step]["options"][$parent.$index]'
													ng-change='appendSubStepEditInfo()'
													>{{radioOp}}
											</label>
										</div>
									</div>
								</div>
							</div>

							<div class='form-group'>
								<label class='control-label col-sm-2'>Qulity: </label>
								<div class='col-sm-10'>
									<input 
										type='number' 
										class='form-control' 
										placeholder='0' 
										ng-model='travelerData.step[step.step][subStep.sub_step]["qty"]'
										ng-change='appendSubStepEditInfo()'>
								</div>
							</div>	

							<!-- comment -->
							<div class='form-group'>
								<label for='comment' class='control-label col-sm-2'>Comment: </label>
								<div class='col-sm-10'>
									<textarea class='form-control' row='5' id='comment' ng-model='travelerData.step[step.step][subStep.sub_step]["comment"]' ng-change='appendSubStepEditInfo()'
									></textarea>
								</div>
							</div>
						</form>
					</div>

					<!-- status sub page -->
					<div id='status-buttons-sub' class='text-right'>
						<a ng-class='{active: currentSubStep == subStep.sub_step}' ng-repeat='subStep in step.list' ng-if='currentStep==step.step' ng-click='statusSubPage(subStep.sub_step)'><span>{{step.step}}.{{subStep.sub_step}}</span></a>
					</div>
				</div>			
			</div> 	
	</div>
</div>

<div ng-show='travelerData.readyReview' ui-view='formReview' id='div-id-selector'></div>

<br>
<!-- <input class='btn btn-primary myButton btn-lg pull-right' ng-if='!readySubmit' type="button" value='next' ng-click='nextStep()'/> -->
<input class='btn btn-primary myButton btn-md pull-right hidden-print' ng-if='travelerData.readyReview && !travelerData.created' type="button" value='submit' ng-click='submit()'/>
<input ng-show='formId' class='btn btn-primary myButton btn-md pull-right hidden-print'  type='button' value='Save/Update' ng-click='save()'/>
<input class='btn btn-primary myButton btn-md pull-right hidden-print' ng-if='travelerData.readyReview' type='button' value='Go Back' ng-click='goBack()'/>


<!-- <br>
<br>
<br>
<br>
travelerData: <pre>{{travelerData |json}}</pre><br>
formTemplate: <pre>{{forms |json}}</pre><br>
formId{{formId}} -->
travelerData: <pre>{{travelerData |json}}</pre><br>
</div>